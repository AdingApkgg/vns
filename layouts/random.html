{{ define "main" }}
<article class="article-main">
  <h1><i class="fas fa-hashtag"></i>&nbsp;{{ .Title }}</h1>
  <div class="content">{{ .Content }}</div>
  <script>
    fetch("/p/index.xml")
      .then((response) => {
        if (!response.ok) throw new Error("Failed to fetch index.xml");
        return response.text();
      })
      .then((xmlText) => {
        const parser = new DOMParser();
        const xmlDoc = parser.parseFromString(xmlText, "text/xml");
        const links = xmlDoc.getElementsByTagName("link");
        const posts = Array.from(links)
          .map((link) => link.textContent)
          .filter((url) => url !== "{{ .Site.BaseURL }}");

        if (!posts || posts.length === 0) {
          document.body.innerHTML =
            "<p>No random pages found. Please try again.</p>";
          return;
        }
        const randomUrl = posts[Math.floor(Math.random() * posts.length)];
        pjax.loadUrl(randomUrl);
      })
      .catch((error) => {
        document.body.innerHTML =
          "<p>Error loading random page. Please try again.</p>";
      });
  </script>
</article>
{{ end }}
