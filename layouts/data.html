{{ define "main" }}
<style>
    article div#content {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 16px;
        justify-content: center;
        padding: 16px;
        background: var(--bg-color);
    }

    article div#content .item {
        border: 1px solid rgba(0, 0, 0, 0.1);
        border-radius: 12px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
        background: var(--bg-color);
        overflow: hidden;
        display: flex;
        flex-direction: column;
        padding: 16px;
        transition: transform 0.2s, box-shadow 0.2s;
    }

    article div#content .item:hover {
        transform: translateY(-5px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
    }

    article div#content .item img {
        width: 100%;
        height: 180px;
        object-fit: cover;
        border-radius: 8px;
        margin-bottom: 12px;
    }

    article div#content .item .title {
        font-size: 1.25rem;
        font-weight: bold;
        margin-bottom: 8px;
        color: var(--text-color);
    }

    article div#content .item .company {
        font-size: 0.95rem;
        color: var(--text-color);
        margin-bottom: 8px;
    }

    article div#content .item .description {
        font-size: 0.85rem;
        color: var(--text-color);
        margin-bottom: 12px;
        line-height: 1.5;
    }

    article div#content .item .tags,
    article div#content .item .platforms {
        font-size: 0.8rem;
        color: var(--text-color);
        margin-bottom: 8px;
    }

    article div#content .item .downloads {
        margin-top: auto;
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
    }

    article div#content .item .download-button {
        background: var(--link-color);
        color: #fff;
        border: none;
        border-radius: 6px;
        padding: 8px 12px;
        font-size: 0.85rem;
        cursor: pointer;
        transition: background 0.2s, transform 0.2s;
    }

    article div#content .item .download-button:hover {
        background: #4a5568;
        transform: scale(1.05);
    }

    @media (max-width: 480px) {
        article div#content {
            padding: 12px;
            gap: 12px;
        }

        article div#content .item {
            padding: 12px;
        }

        article div#content .item img {
            height: 150px;
        }

        article div#content .item .title {
            font-size: 1.1rem;
        }

        article div#content .item .company,
        article div#content .item .description,
        article div#content .item .tags,
        article div#content .item .platforms {
            font-size: 0.75rem;
        }

        article div#content .item .download-button {
            padding: 6px 10px;
            font-size: 0.75rem;
        }
    }
</style>
<article>
    <h1>分流</h1>
    <div id="content"></div>
</article>
<script>
    document.addEventListener("DOMContentLoaded", () => {
        fetchData();
    });
    document.addEventListener("pjax:complete", () => {
        fetchData();
    });

    function fetchData() {
        const jsonUrl = "https://ghfast.top/https://raw.githubusercontent.com/AdingApkgg/vns/data/data.json";

        fetch(jsonUrl)
            .then((response) => {
                if (!response.ok) {
                    throw new Error("网络响应失败");
                }
                return response.json();
            })
            .then((data) => {
                const contentDiv = document.getElementById("content");
                contentDiv.innerHTML = "";
                data.forEach((item) => {
                    const itemDiv = document.createElement("div");
                    itemDiv.className = "item";

                    const title = document.createElement("h2");
                    title.className = "title";
                    title.textContent = item.title;
                    itemDiv.appendChild(title);

                    const cover = document.createElement("img");
                    cover.className = "cover";
                    cover.src = item.cover;
                    cover.alt = item.title;
                    cover.title = item.title
                    cover.loading = "lazy";
                    itemDiv.appendChild(cover);

                    const description = document.createElement("p");
                    description.className = "description";
                    description.textContent = item.description;
                    itemDiv.appendChild(description);

                    const company = document.createElement("p");
                    company.className = "company";
                    company.textContent = `会社：${item.company}`;
                    itemDiv.appendChild(company);

                    const tags = document.createElement("p");
                    tags.className = "tags";
                    tags.textContent = `标签：${item.tags.join("、")}`;
                    itemDiv.appendChild(tags);

                    const platforms = document.createElement("p");
                    platforms.className = "platforms";
                    platforms.textContent = `平台：${item.platforms.join("、")}`;
                    itemDiv.appendChild(platforms);

                    const downloads = document.createElement("p");
                    downloads.className = "downloads";
                    downloads.textContent = "分流：";

                    item.downloads.forEach((download) => {
                        const button = document.createElement("button");
                        button.className = "download-button";
                        button.textContent = `${download.provider}`;
                        button.onclick = () => window.open(download.url, "_blank");
                        downloads.appendChild(button);
                    });

                    itemDiv.appendChild(downloads);
                    contentDiv.appendChild(itemDiv);
                });
            })
            .catch((error) => {
                console.error("获取数据失败:", error);
                document.getElementById("content").textContent =
                    "加载数据失败，请稍后重试。";
            });
    }
</script>
{{ end }}